# 23.04.06. DB 조작과 모델링

# SQL

## Aggregate Function

- 집계 함수
- SELECT 문의 GROUP BY절과 함께 종종 사용 된다.
- AVG(), COUNT(), MAX(), MIN(), SUM()
- 숫자를 기준으로 계산이 되기 때문에 반드시 컬럼 데이터 타입이 숫자(INTEGER)일 때만 사용 가능.

### GROUP BY

- 특정 그룹으로 묶인 결과를 생성
- SELECT문의 FROM 절 뒤에 작성, WHERE 절이 포함된 경우 WHERE 절 뒤에 작성해야 된다.

```sql
# 지역별 평균 balance, 정렬까지

SELECT country, avg(balance)
FROM users
GROUP BY country
ORDER BY avg(balance) DESC;
```

```sql
# 성씨 가장 많은 순서대로 정렬

SELECT last_name, 
       COUNT(*) AS counts_last_name
FROM users
GROUP BY last_name
ORDER BY COUNT(*) DESC;
```

## Changing Data

```sql
# 테이블 생성하기

CREATE TABLE classmates(
  name TEXT NOT NULL,
  age INTEGER NOT NULL,
  address TEXT NOT NULL
);
```

```sql

# 두 방법 모두 가능 (컬럼 명 안써주면 순서대로 값이 들어간다)

INSERT INTO classmates(name, age, address)
VALUES ('홍길동', 23, '서울');

INSERT INTO classmates
VALUES 
  ('김철수', 30, '경기'),
  ('이영미', 31, '강원'),
  ('박진성', 26, '전라'),
  ('최지수', 12, '충청'),
  ('정요한', 28, '경상');
```

```sql
# 2번 데이터 이름을 '김철수한무두루미', 주소를 '제주도'로 수정하기

UPDATE classmates
SET name='김철수한무두루미',
    address='제주도'
WHERE rowid=2;
```

```sql
# 데이터 삭제하기

DELETE FROM classmates
WHERE rowid=5;

# 삭제된 것 확인하기

SELECT rowid, *
FROM classmates;

# 테이블 모두 삭제

DELETE FROM classmates;
```

# 정규형

**정규형은 시험에 최대한 안 나온다고 한다**

- 데이터베이스를 구조화하는 방법론
- 데이터의 중복을 최소화하고 일관성과 무결성을 보장하기 위함
- 데이터의 구조를 더 좋은 구조로 바꾸는 것을 정규화라고 한다.
- 관계형 데이터베이스의 경우 6개의 정규형이 있음

## 제 1정규형

- 하나의 속성값이 복수형을 가지면 안된다.
- 하나의 속성에는 값이 하나만 들어가야 한다.

| id | 등록 상태 | 고객 이름 | 운동 |
| --- | --- | --- | --- |
| 1 | 등록완료 | 박민서 | 헬스 |
| 2 | 결제대기중 | 박민서 | 수영 |
| 3 | 결제완료 | 김민준 | 헬스 |
| 4 | 상담 | 이서연 | 필라테스 |
| 5 | 상담 | 김민준 | 필라테스 |

`필라테스`가 좋다는 것을 들은 `박민서`가 상담을 끝내고 `결제 대기중`이라면 어떻게 테이블에 넣어야 될까?

| id | 등록 상태 | 고객 이름 | 운동 |
| --- | --- | --- | --- |
| 1 | 등록완료 | 박민서 | 헬스 |
| 2 | 결제대기중 | 박민서 | 수영, 필라테스 |
| 3 | 결제완료 | 김민준 | 헬스 |
| 4 | 상담 | 이서연 | 필라테스 |
| 5 | 상담 | 김민준 | 필라테스 |

위와 같이 해도 되긴 된다. **하지만 이렇게 하지 말라는 것이 제 1정규형이다.**

## 제 2정규형

- 테이블의 테마와 관련 없는 컬럼은 다른 테이블로 분리하는 것

| 회원id | 강사명 | 운동 | 금액 |
| --- | --- | --- | --- |
| 1001 | 최지호 | 헬스 | 60000 |
| 1001 | 김민정 | 수영 | 5000 |
| 1002 | 고창준 | 헬스 | 60000 |
| 1002 | 신아연 | 필라테스 | 50000 |
| 1003 | 신아연 | 필라테스 | 50000 |

여기에서 수영 가격이 올라갔다면?

| 회원id | 강사명 | 운동 | 금액 |
| --- | --- | --- | --- |
| 1001 | 최지호 | 헬스 | 60000 |
| 1001 | 김민정 | 수영 | 10000 |
| 1002 | 고창준 | 헬스 | 60000 |
| 1002 | 신아연 | 필라테스 | 50000 |
| 1003 | 신아연 | 필라테스 | 50000 |
- 지금은 한 개의 데이터지만 회원이 몇 천명이 된다면 전부 수정해야 된다.
- 또한 어떤 회원이 어떤 운동을 수강하고 있는지만 확인하고 싶은데 위와 같은 데이터 테이블은 데이터 하나를 넣으려고 해도 원치 않은 데이터도 함께 넣어줘야 하는 번거로움이 있다.

| 회원id | 강사명 |
| --- | --- |
| 1001 | 최지호 |
| 1001 | 김민정 |
| 1002 | 고창준 |
| 1002 | 신아연 |
| 1003 | 신아연 |

                <등록 테이블>

| 강사명 | 운동 | 금액 |
| --- | --- | --- |
| 최지호 | 헬스 | 60000 |
| 김민정 | 수영 | 10000 |
| 고창준 | 헬스 | 60000 |
| 신아연 | 필라테스 | 50000 |

                           <운동 테이블

### 제 2정규형 공돌이 ver. (넘겨도 된다)

- 테이블에서 부분 함수적 종속성을 제거한 것
- 부분 함수적 종속성 == 키가 아닌 속성이 기본키의 일부분에 종속되는 것
- 복합키: 테이블에서 행을 유일하게 구분하기 위해 두 개 이상의 속성을 조합하여 사용하는 기본키 → 두 개 묶어서 pk

## 제 3정규형

다른 속성에 의존하는 속성은 따로 분리할 것

| 강사명 | 운동 | 금액 |
| --- | --- | --- |
| 최지호 | 헬스 | 60000 |
| 김민정 | 수영 | 10000 |
| 고창준 | 헬스 | 60000 |
| 신아연 | 필라테스 | 50000 |

금액은 PK인 강사명에 의존하고 있지 않고 운동에 의존하고 있다.

| 강사명 | 운동 |
| --- | --- |
| 최지호 | 헬스 |
| 김민정 | 수영 |
| 고창준 | 헬스 |
| 신아연 | 필라테스 |

| 운동 | 금액 |
| --- | --- |
| 헬스 | 60000 |
| 수영 | 10000 |
| 필라테스 | 50000 |

가격 테이블

강사 테이블

# JOIN

- 테이블은 여러 개로 나눠져 있지만 결국 우리가 데이터를 조회하려면 모아서 테이블 한 개로 만들어야 한다.
- 따라서 테이블을 연결해야 하고 이를 위해 `JOIN`을 사용한다.