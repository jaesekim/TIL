# 23.04.05. Database

# Database

- database
    
    “A **database** is an organized collection of data”
    
- DBMS(Database Management Sytstem)
    
    “**DBMSs** are specially designed software applications that interact with the user, other applications, and the database itself to capture and analyze data”
    
- 관계형 데이터베이스
    - SQLite, MySQL, ORACLE, etc
    - 한계
        - 틀이 정해져 있다.
        - 관계를 증명해야 된다.
        - 추후 수정이 어렵다.
- 비관계형 데이터베이스
    - 관계형 데이터 베이스의 한계를 극복하기 위해 조금 더 유연한 데이터베이스.
    - 실제로 서브 데이터 베이스로 두고 빠른 처리, 확장이 필요한 기능에서 사용하는 경우가 많다.
    - 일반적으로 메인 데이터 베이스는 관계형 데이터 베이스를 사용

# 관계형 데이터 베이스

- 회원 가입: C
- 회원 탈퇴: D
- 프로필 조회: R
- 프로필 수정: U
- 새로운 피드 작성: D
- 좋아요: C, D
- 팔로우: C, D

## 관계형 데이터베이스(RDB)

- 데이터를 테이블 행, 열 등으로 나눠서 구조화하는 방식
- 구조화해서 저장하므로 보다 체계적으로 데이터를 저장하고 관리할 수 있음
- 자료를 여러 테이블로 나눠서 관리하고 테이블 간 관계를 설정해 여러 데이터를 조작할 수 있다.
- 데이터의 무결성(정확성, 일관성) 유지에 장점이 있다
- SQL을 사용하여 데이터를 조회하고 조작

| id | 주문일 |  주문상태 |  고객 ID |
| --- | --- | --- | --- |
| 1 | 2023/01/01 | 배송 완료 | 3 |
| 2 | 2023/03/01 | 상품 준비중 | 3 |
| 3 | 2023/02/03 | 배송 중 | 1 |

| id |  이름 |  청구지 |  주소지 |
| --- | --- | --- | --- |
| 1 | 김민준 | 서울 | 강원 |
| 2 | 이서연 | 경기 |  경기 |
| 3 |  박민서 | 서울 |  서울 |

## 관계형 데이터베이스의 구조

### 스키마(Schema)

- 테이블의 구조(Structure)
- 데이터베이스에서 자료의 구조, 표현 방법, 관계 등 전반적인 명세를 기술한 것
- 예시
    
    
    | column | datatype |
    | --- | --- |
    | id | INTEGER |
    | name | TEXT |
    | address | TEXT |
    | age | INTEGER |

### 테이블

- 필드와 레코드를 사용해 조직된 데이터 요소들의 집합
- 관계(Relation)라고도 부름
    1. 필드(field): 속성, 컬럼(column)
    2. 레코드(recode): 튜플, 행(row)

**필드(Field)**

- 속성 혹은 컬럼(column)
- 각 필드에는 고유한 데이터 형식(타입)이 지정됨

**레코드(Record)**

- 튜플 혹은 행(row)
- 테이블의 데이터는 레코드에 저장된다.

**PK(Primary Key)**

- 기본 키
- 각 레코드의 고유한 값. 즉, 각각의 데이터를 구분할 수 있는 고유값
- 기술적으로 다른 항목과 절대로 중복될 수 없는 단일 값(unique)
- 데이터베이스 관리 및 테이블 간 관계 설정 시 주요하게 활용

**FK(Foreign Key)**

아래 표에서 누가 어떤 주문을 했는지 식별할 수 있을까? → NO

| id | 주문일 |  주문상태 |
| --- | --- | --- |
|  | 2023/01/01 | 배송 완료 |
| 2 | 2023/03/01 | 상품 준비중 |
| 3 | 2023/02/03 | 배송 중 |

| id |  이름 |  청구지 |  주소지 |
| --- | --- | --- | --- |
| 1 | 김민준 | 서울 | 강원 |
| 2 | 이서연 | 경기 |  경기 |
| 3 |  박민서 | 서울 |  서울 |
- 한 테이블의 속성 중 다른 테이블의 레코드를 식별할 수 있는 키
- 다른 테이블의 기본 키를 참조
- 참조하는 테이블의 속성 1개 값은 참조되는 측 테이블의 레코드 값에 대응된다.
- 각 레코드에서 서로 다른 테이블 간의 관계를 만드는 데 사용할 수 있다.
- FK 적용
    
    
    | id | 주문일 |  주문상태 |  고객 ID |
    | --- | --- | --- | --- |
    | 1 | 2023/01/01 | 배송 완료 | 3 |
    | 2 | 2023/03/01 | 상품 준비중 | 3 |
    | 3 | 2023/02/03 | 배송 중 | 1 |

# SQL

Structured Query Language: 관계형 데이터베이스에서 데이터를 관리하기 위해 사용하는 언어

== 데이터베이스 관리 + CRUD 하는 언어

## SQL Commands

| 분류 |  개념 | SQL 키워드 |
| --- | --- | --- |
| DDL: 데이터 정의 언어 | 관계형 데이터베이스 구조(테이블, 스키마)를 정의(생성, 수정 및 삭제)하기 위한 명령어 | CREATE, DROP, ALTER |
| DML: 데이터 조작 언어 | 데이터를 조작(추가, 조회, 변경, 삭제)하기 위한 명령어 |  INSERT, SELECT, UPDATE, DELETE |
| DCL | 아직 |  몰라도 된다 |

## SQL Syntax

- 모든 SQL문(statement)는 SELECT, INSERT, UPDATE 등과 같은 키워드로 시작하고 하나의 statement는 `세미콜론(;)`으로 끝난다.
- SQL 키워드는 대소문자를 구분하지 않지만 대문자 작성 권장

## Data Types 종류

1. NULL: 정보가 없거나 알 수 없음을 의미
2. INTEGER: 정수. 크기에 따라 0, 1, 2, 3, 4, 6, 8 바이트와 같은 가변 크기를 가진다.
3. REAL: 실수. 8바이트 부동 소수점을 사용하는 10진수 값이 있는 실수
4. TEXT: 문자 데이터
5. BLOB(Binary Large Object): 입력된 그대로 저장된 데이터 덩어리(대용 타입 없음)

# Constraints

- 제약조건
- 입력하는 자료에 대해 제약을 정한다
- 제약에 맞지 않다면 입력이 거부된다
- 사용자가 원하는 조건의 데이터만 유지하기 위한 즉, 데이터의 무결성을 유지하기 위한 보편적인 방법으로 테이블의 특정 컬럼에 설정하는 제약

## 데이터 무결성

- 데이터베이스 내의 데이터에 대한 정확성, 일관성을 보장하기 위해 데이터 변경 혹은 수정 시 여러 제한을 두어 데이터의 정확성을 보증하는 것.
- 무결성이란 데이터의 정확성, 일관성을 나타낸다.
- 데이터베이스에 저장된 데이터의 무결성을 보장하고 데이터베이스의 상태를 일관되게 유지하는 것이 목적이다.

## Constraint 종류

1. NOT NULL
    - 컬럼이 NULL 값을 허용하지 않도록 지정
    - 기본적으로 테이블의 모든 컬럼은 NOT NULL 제약 조건을 명시적으로 사용하는 경우를 제외하고 NULL 값을 허용한다.
2. UNIQUE
    - 컬럼의 모든 값이 서로 구별되거나 고유한 값이 되도록 한다.
3. PRIMARY KEY
    - 테이블에서 행의 고유성을 식별하는 데 사용되는 컬럼
    - 각 테이블에는 하나의 기본 키만 있다.
    - 암시적으로 NOT NULL 제약 조건이 포함되어 있다.
4. AUTOINCREMENT
    - 사용하지 않은 값이나 이전에 삭제된 행의 값을 재사용하는 것을 방지
    - INTETGER PRIMARY KEY 다음에 작성하면 해당 rowid를 다시 재사용하지 못하도록 한다.
    - Django에서 테이블 생성 시 id 컬럼에 기본적으로 사용하는 제약 조건

### rowid의 특징

- 테이블을 생성할 때마다 rowid라는 암시적 자동 증가 컬럼이 자동으로 생성된다.
- 테이블의 행을 고유하게 식별하는 64비트 부호 있는 정수 값
- 테이블에 새 행을 삽입할 때마다 정수 값을 자동으로 할당
    - 값은 1에서 시작
    - 데이터 삽입 시에 rowid 또는 INTEGER PRIMARY KEY 컬럼에 명시적으로 값이 지정되지 않은 경우 SQLite는 테이블에서 가장 큰 rowid보다 하나 큰 다음 순차 정수를 자동으로 할당 (AUTOINCREMENT와 관계없이)

# Alter Table

- Modify the structure of an existing table
1. Alter Table Rename’
    - `ALTER TABLE contacts RENAME TO new_contacts;`
    - 우클릭 후 `Run Selected Query`
    - db에서 새로고침
2. Drop Table
    
    `DROP TABLE new_contacts;`
    

## DDL 정리

- 데이터 정의 언어
- CREATE TABLE
    - 데이터 타입과 제약 조건
- ALTER TABLE
    - RENAME
    - RENAME COLUMN
    - ADD COLUMN
    - DROP COLUMN
- DROP TABLE